<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeerJS Livestream</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.3.1/peerjs.min.js"></script>
    <style>
        video { width: 300px; height: 200px; border: 1px solid black; margin: 5px; }
    </style>
</head>
<body>
    <h1>PeerJS Livestream</h1>
    <video id="localVideo" autoplay muted></video>
    <video id="remoteVideo" autoplay></video>
    <button id="startButton">Start Streaming</button>

    <script>
        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');
        const startButton = document.getElementById('startButton');

        let localStream;
        let peer;
        let call;

        // Initialize PeerJS
        peer = new Peer(undefined, {
            host: 'peerjs.com',
            port: 443,
            path: '/myapp'
        });

        // Get access to the user's camera and microphone
        async function startStream() {
            localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            localVideo.srcObject = localStream;

            // Wait for incoming calls
            peer.on('call', (incomingCall) => {
                call = incomingCall;
                call.answer(localStream); // Answer the call with our local stream
                call.on('stream', (remoteStream) => {
                    remoteVideo.srcObject = remoteStream; // Display the remote stream
                });
            });
        }

        // Start streaming to a specific peer ID
        function callPeer(peerId) {
            call = peer.call(peerId, localStream);
            call.on('stream', (remoteStream) => {
                remoteVideo.srcObject = remoteStream;
            });
        }

        startButton.addEventListener('click', async () => {
            await startStream();
            const peerId = prompt("Enter the Peer ID to call:");
            if (peerId) {
                callPeer(peerId);
            }
        });

        // Log peer connection
        peer.on('open', (id) => {
            console.log('My peer ID is: ' + id);
        });
    </script>
</body>
</html>
